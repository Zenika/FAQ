# Migration `20200212164206-init`

This migration has been generated by Errorname at 2/12/2020, 4:42:06 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "dev2"."Node" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "question" text  NOT NULL ,
    PRIMARY KEY ("id")
)

CREATE TABLE "dev2"."Question" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "slug" text  NOT NULL DEFAULT '',
    "title" text  NOT NULL DEFAULT '',
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "user" text  NOT NULL ,
    "views" integer  NOT NULL DEFAULT 0,
    PRIMARY KEY ("id")
)

CREATE TABLE "dev2"."Answer" (
    "content" text  NOT NULL DEFAULT '',
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "node" text  NOT NULL ,
    "sources" text  NOT NULL DEFAULT '[]',
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "user" text  NOT NULL ,
    PRIMARY KEY ("id")
)

CREATE TABLE "dev2"."Flag" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "node" text  NOT NULL ,
    "type" text  NOT NULL DEFAULT '',
    "user" text  NOT NULL ,
    PRIMARY KEY ("id")
)

CREATE TABLE "dev2"."Tag" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "label" text  NOT NULL ,
    "node" text  NOT NULL ,
    "user" text  NOT NULL ,
    PRIMARY KEY ("id")
)

CREATE TABLE "dev2"."TagLabel" (
    "category" text  NOT NULL ,
    "id" text  NOT NULL ,
    "name" text  NOT NULL DEFAULT '',
    "order" integer  NOT NULL DEFAULT 0,
    PRIMARY KEY ("id")
)

CREATE TABLE "dev2"."TagCategory" (
    "configuration" text  NOT NULL ,
    "id" text  NOT NULL ,
    "name" text  NOT NULL DEFAULT '',
    "order" integer  NOT NULL DEFAULT 0,
    PRIMARY KEY ("id")
)

CREATE TABLE "dev2"."HistoryAction" (
    "action" text  NOT NULL DEFAULT '',
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "meta" text   ,
    "model" text  NOT NULL DEFAULT '',
    "node" text  NOT NULL ,
    "user" text  NOT NULL ,
    PRIMARY KEY ("id")
)

CREATE TABLE "dev2"."User" (
    "admin" boolean  NOT NULL DEFAULT false,
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "email" text  NOT NULL DEFAULT '',
    "id" text  NOT NULL ,
    "key" text   ,
    "locale" text   ,
    "name" text   ,
    "picture" text   ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
)

CREATE TABLE "dev2"."Configuration" (
    "algoliaSynonyms" text  NOT NULL DEFAULT '[]',
    "authorizedDomains" text  NOT NULL DEFAULT '[]',
    "bugReporting" text  NOT NULL DEFAULT 'GITHUB',
    "id" text  NOT NULL ,
    "name" text  NOT NULL DEFAULT '',
    "slackChannelHook" text   ,
    "slackCommandKey" text   ,
    "title" text  NOT NULL DEFAULT 'Dev',
    "workplaceSharing" boolean  NOT NULL DEFAULT false,
    PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Node_question" ON "dev2"."Node"("question")

CREATE UNIQUE INDEX "Answer_node" ON "dev2"."Answer"("node")

CREATE UNIQUE INDEX "User.email" ON "dev2"."User"("email")

CREATE UNIQUE INDEX "Configuration.name" ON "dev2"."Configuration"("name")

ALTER TABLE "dev2"."Node" ADD FOREIGN KEY ("question") REFERENCES "dev2"."Question"("id") ON DELETE RESTRICT

ALTER TABLE "dev2"."Question" ADD FOREIGN KEY ("user") REFERENCES "dev2"."User"("id") ON DELETE RESTRICT

ALTER TABLE "dev2"."Answer" ADD FOREIGN KEY ("node") REFERENCES "dev2"."Node"("id") ON DELETE RESTRICT

ALTER TABLE "dev2"."Answer" ADD FOREIGN KEY ("user") REFERENCES "dev2"."User"("id") ON DELETE RESTRICT

ALTER TABLE "dev2"."Flag" ADD FOREIGN KEY ("node") REFERENCES "dev2"."Node"("id") ON DELETE RESTRICT

ALTER TABLE "dev2"."Flag" ADD FOREIGN KEY ("user") REFERENCES "dev2"."User"("id") ON DELETE RESTRICT

ALTER TABLE "dev2"."Tag" ADD FOREIGN KEY ("node") REFERENCES "dev2"."Node"("id") ON DELETE RESTRICT

ALTER TABLE "dev2"."Tag" ADD FOREIGN KEY ("label") REFERENCES "dev2"."TagLabel"("id") ON DELETE RESTRICT

ALTER TABLE "dev2"."Tag" ADD FOREIGN KEY ("user") REFERENCES "dev2"."User"("id") ON DELETE RESTRICT

ALTER TABLE "dev2"."TagLabel" ADD FOREIGN KEY ("category") REFERENCES "dev2"."TagCategory"("id") ON DELETE RESTRICT

ALTER TABLE "dev2"."TagCategory" ADD FOREIGN KEY ("configuration") REFERENCES "dev2"."Configuration"("id") ON DELETE RESTRICT

ALTER TABLE "dev2"."HistoryAction" ADD FOREIGN KEY ("node") REFERENCES "dev2"."Node"("id") ON DELETE RESTRICT

ALTER TABLE "dev2"."HistoryAction" ADD FOREIGN KEY ("user") REFERENCES "dev2"."User"("id") ON DELETE RESTRICT
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200212164206-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,159 @@
+// The two following datasources (tenant and management) are REQUIRED for prisma-multi-tenant
+
+datasource tenant {
+  provider = "postgresql"
+  url      = env("PMT_URL")
+}
+
+datasource management {
+  provider = "sqlite"
+  url      = env("MANAGEMENT_URL")
+  enabled  = false
+}
+
+// End of prisma-multi-tenant
+
+generator photon {
+  provider = "prisma-client-js"
+}
+
+model Node {
+  id String @default(cuid()) @id
+
+  question Question @relation(name: "NodeQuestion") // , onDelete: CASCADE)
+  answer   Answer?  @relation(name: "NodeAnswer") // , onDelete: CASCADE)
+
+  flags Flag[] @relation(name: "NodeFlags") // , onDelete: CASCADE)
+  tags  Tag[]  @relation(name: "NodeTags") // , onDelete: CASCADE)
+
+  history HistoryAction[] @relation(name: "NodeHistoryActions") // , onDelete: CASCADE)
+
+  createdAt DateTime @default(now())
+}
+
+model Question {
+  id String @default(cuid()) @id
+
+  title String
+  slug  String
+  views Int
+
+  node Node @relation(name: "NodeQuestion")
+  user User @relation(name: "UserQuestions")
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Answer {
+  id String @default(cuid()) @id
+
+  content String
+
+  sources String @default("[]")
+
+  node Node @relation(name: "NodeAnswer")
+  user User @relation(name: "UserAnswers")
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Flag {
+  id String @default(cuid()) @id
+
+  type String
+
+  node Node @relation(name: "NodeFlags")
+  user User @relation(name: "UserFlags")
+
+  createdAt DateTime @default(now())
+}
+
+model Tag {
+  id String @default(cuid()) @id
+
+  label TagLabel @relation(name: "TagsLabel")
+
+  node Node @relation(name: "NodeTags")
+  user User @relation(name: "UserTags")
+
+  createdAt DateTime @default(now())
+}
+
+model TagLabel {
+  id String @default(cuid()) @id
+
+  name String
+  tags Tag[]  @relation(name: "TagsLabel") // , onDelete: CASCADE)
+
+  order    Int
+  category TagCategory @relation(name: "TagLabelsCategory")
+}
+
+model TagCategory {
+  id String @default(cuid()) @id
+
+  name   String
+  labels TagLabel[] @relation(name: "TagLabelsCategory") // , onDelete: CASCADE)
+
+  order         Int
+  configuration Configuration @relation(name: "ConfigurationTags")
+}
+
+model HistoryAction {
+  id String @default(cuid()) @id
+
+  action String
+  model  String
+  meta   String?
+
+  node Node @relation(name: "NodeHistoryActions")
+  user User @relation(name: "UserHistoryActions")
+
+  createdAt DateTime @default(now())
+}
+
+model User {
+  id    String  @id
+  email String  @unique
+  key   String?
+
+  admin Boolean @default(false)
+
+  name    String?
+  picture String?
+  locale  String?
+
+  questions Question[] @relation(name: "UserQuestions")
+  answers   Answer[]   @relation(name: "UserAnswers")
+
+  flags Flag[] @relation(name: "UserFlags")
+  tags  Tag[]  @relation(name: "UserTags")
+
+  history HistoryAction[] @relation(name: "UserHistoryActions")
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Configuration {
+  id   String @default(cuid()) @id
+  name String @unique
+
+  title String @default("Dev")
+
+  authorizedDomains String       @default("[]")
+  algoliaSynonyms   String       @default("[]")
+  slackChannelHook  String?
+  slackCommandKey   String?
+  workplaceSharing  Boolean      @default(false)
+  bugReporting      BugReporting @default(GITHUB)
+
+  tagCategories TagCategory[] @relation(name: "ConfigurationTags") // , onDelete: CASCADE)
+}
+
+enum BugReporting {
+  MAIL
+  GITHUB
+}
```
